<!DOCTYPE html>
<html>
    <head>
      <meta charset="UTF-8">
        <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
        <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'"> -->
        <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' ; script-src 'self' 'unsafe-inline'; style-src 'self' "> -->
        <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; script-src-elem 'self' 'unsafe-inline';"> -->
        <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline' https://unpkg.com; script-src 'self' 'unsafe-inline' https://d3js.org https://unpkg.com;">

        <title>Hello World!</title>

        <link rel="stylesheet" href="grafico.css">


        <link rel="stylesheet" href="../node_modules/cal-heatmap/cal-heatmap.css" />
        <link rel="stylesheet" href="../node_modules/cal-heatmap/cal-heatmap.js" />
        <link rel="stylesheet" href="../node_modules/cal-heatmap/cal-heatmap.min.js" />
        <link rel="stylesheet" href="../node_modules/d3/d3.js" />



        <!-- <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src="https://unpkg.com/cal-heatmap/dist/cal-heatmap.min.js"></script>
        <link rel="stylesheet" href="https://unpkg.com/cal-heatmap/dist/cal-heatmap.css">
        <script src="https://d3js.org/d3.v6.min.js"></script> -->
    </head>
  <body>
      <div id="header"></div>
      <h1>hola</h1>
      <div id="cal-heatmap"></div>
      
      <!-- <div id="cal-heatmap-container"></div> -->
      
      <!-- <script src="grafico.js"></script> -->

      <div id="CalHeatmap"></div>
      

      <script>
       const CalHeatMap = require('cal-heatmap');
      
       var data = {
        '2023-12-18': 5,
        '2023-12-19': 10,
        '2023-12-20': 3,
        '2023-12-21': 8,
        '2023-12-22': 6,
        '2023-12-23': 12,
        '2023-12-24': 4,
        '2023-1-1': 24,
        '2023-2-4': 64,
    };
    
    var datasjs = {};
    
    Object.keys(data).forEach(function(key) {
        var date = new Date(key);
        var timestamp = Math.floor(date.getTime() / 1000); // Convertir la fecha a timestamp UNIX
    
        // Transformar los valores como se desee
        var transformedValue = data[key] * 0.5; // Solo un ejemplo de transformación
    
        datasjs[timestamp] = transformedValue; // Asignar el valor transformado al nuevo objeto
    });
    
    console.log(datasjs); // Mostrar el nuevo objeto con fechas en formato timestamp y valores transformados
    
    
   

      const fs = require('fs');
      const Papa = require('papaparse');
      
      function transformarDatos(idHabito, archivo) {
          const data = fs.readFileSync(archivo, 'utf8');
          const records = Papa.parse(data, {
              header: true,
              skipEmptyLines: true
          }).data;
      
          let datasjs = {};
          for (let record of records) {
              if (parseInt(record.id_habito) === idHabito) {
                  let fecha = record.fecha;
                  let duracion = record.duracion;
                  // Convertir la fecha a timestamp
                  let timestamp = Math.floor(new Date(fecha).getTime() / 1000);
                  // Convertir la duración a minutos
                  let [h, m, s] = duracion.split(':').map(Number);
                  let minutos = h * 60 + m + s / 60;
                  datasjs[timestamp] = minutos;
              }
          }
          console.log(datasjs);

          var cal = new CalHeatMap();
          cal.init({
            data: datasjs,
            start: new Date(2023, 0),
            id: "cal-heatmap",
            domain: "month",
            subDomain: "x_day",
            cellSize: 15,
            cellpadding: 3,
            domainGutter: 15,
            itemName: window.innerWidth < 768 ? ["week", "day"] : ["month", "day"], // Cambiar la unidad de tiempo según el ancho de la ventana
          });
      }
      
      // Uso de la función
     

      function definir() {
        const { ipcRenderer } = require('electron')
    
            ipcRenderer.on('button-value', function (event, value) {
              
                document.getElementById('header').innerText = value.nombre;

                transformarDatos(value.id, 'historial_habitos.csv');
    
               
            });
        
    }

    definir()
    
      


      
    
      </script>


  </body>
</html>
