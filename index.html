<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'"> -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'"> -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline' https://unpkg.com; script-src 'self' 'unsafe-inline' https://d3js.org https://unpkg.com;">

    <title>Habitos</title>
    <link rel="stylesheet" href="./node_modules/cal-heatmap/cal-heatmap.css">
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="all.css">
    <link rel="stylesheet" href="node_modules/material-icons/iconfont/material-icons.css">
    <script src="index.js"></script>

    <link rel="stylesheet" href="grafico/grafico.css">
    <link rel="stylesheet" href="all.css">

    <link rel="stylesheet" href="node_modules/cal-heatmap/cal-heatmap.css" />
    <link rel="stylesheet" href="node_modules/cal-heatmap/cal-heatmap.js" />
    <link rel="stylesheet" href="node_modules/cal-heatmap/cal-heatmap.min.js" />
    <link rel="stylesheet" href="node_modules/d3/d3.js" />

    <script src="grafico/grafico.js"></script>

  </head>
  <body>


 

    <ul id="list">
      <!-- Los elementos de la lista ser√°n a√±adidos aqu√≠ por JavaScript -->
  </ul>



    <!-- <script>
      function saveListToFile(list) {
        // Convierte la lista a una cadena JSON
        const data = JSON.stringify(list);
    
        // Escribe la cadena JSON en un archivo
        fs.writeFile('list.json', data, (err) => {
            if (err) {
                console.error('Hubo un error al escribir el archivo', err);
            } else {
                console.log('Archivo guardado con √©xito');
            }
        });
    }
    
      // Elemento <ul> que ser√° ordenado
const menuList = document.querySelector("#list");

// Conjunto de datos a ordenar arrastrando y soltando
let listElements = ["gato üêà", "loro ü¶ú", "elefante üêò", "serpiente üêç"];

// Renderiza los elementos <li> en cada cambio de datos
function renderUpdateList(list, target) {
    // Limpia todos los <li> anteriores
    target.textContent = "";

    // Se itera cada elemento de la lista para crear un <li>
    list.forEach((value, index) => {
        const myLi = document.createElement("li");
        myLi.textContent = value;
        myLi.setAttribute("draggable", "true");
        myLi.setAttribute("data-key", index);  // A√±ade el atributo data-key

        // Eventos
        myLi.addEventListener("drop", eventDrop);
        myLi.addEventListener("dragover", eventDragOver);

        // Se a√±ade al documento
        target.appendChild(myLi);
    });
}

// Drag Start - <li> que se est√° arrastrando.
let myDragElement = undefined;

menuList.addEventListener("dragstart", (event) => {
    // Guarda qu√© elemento se est√° moviendo.
    myDragElement = event.target;
});

// Drag over - <li> que est√° debajo del elemento que se est√° arrastrando.
let eventDragOverIndex = -1;

function eventDragOver(event) {
    event.preventDefault();
}

function eventDrop(event) {
    event.preventDefault();

    // Obtiene los √≠ndices de los elementos implicados
    let dragIndex = myDragElement.dataset.key;
    let dropIndex = event.target.dataset.key;

    // Mueve el elemento arrastrado a la nueva posici√≥n
    listElements.splice(dropIndex, 0, listElements.splice(dragIndex, 1)[0]);

    // Renderiza la lista actualizada
    renderUpdateList(listElements, menuList);

    saveListToFile(listElements);
}

// Inicializa la lista
renderUpdateList(listElements, menuList);

    </script> -->

    <!-- <div id="cal-heatmap"></div>

    <script type="module">
      import * as d3 from 'd3';
      import * as CalHeatMap from 'cal-heatmap';
    </script>

    <script type="text/javascript">

      const d3 = require('d3');
      const CalHeatMap = require('cal-heatmap');
      
  

  datasjs =  {
    "1258185600": 2.77,
    "1258272000": 2.52,
    "1258358400": 3.23,
    "1258444800": 2.06,
    "1258617600": 2.62,
    "1258704000": 3.9,
    "1258790400": 3.41,
    "1258963200": 0,
    "1259049600": 0,
    "1259136000": 3.16,
    "1259308800": 2.97,
    "1259395200": 2.79,
    "1259481600": 3.65,
    "1259654400": 1.9,
    "1259740800": 3.46,
    "1259827200": 3.93,
    "1260000000": 4.1
  }

  var cal = new CalHeatMap();
  cal.init({
    data: datasjs,
    start: new Date(2009, 10, 1),
    id: "cal-heatmap",
    domain: "month",
    subDomain: "x_day",
    cellSize: 15,
    cellpadding: 3,
    domainGutter: 15
  });
  


 
  
</script> -->

    <!-- <div id="heatmap">
      
    </div>

    <svg id="miSVG" >
    </svg> -->
    

    <div class="columnas">
      <div class="columna1">

        <div id="ventana1" class="ventana">
          <!-- <h1>Ventana 1</h1> -->
          <!-- <button onclick="cambiarVentana('ventana2')">Ir a la ventana 2</button> -->
          <button class="material-icons" onclick="configurar_habito_nuevo()" >  add</button>
          <ul id="miLista">
          </ul>
          <ul id="miLista_hechos">
          </ul>
        </div>
        
        <div id="ventana2" class="ventana" style="display: none;">
          <!-- <h1>Ventana 2</h1> -->
          <div class="botones_superior">
            <button class="material-icons" onclick="cambiarVentana('ventana1')">arrow_back</button>
            <button class="material-icons" id="boton_borrar" onclick="eliminar_habito()">delete</button>

          </div>
          <h2 id="titulo_habito"></h2>
          <div class="contenedor_formulario">

          
          <div id="formDiv" >
          
            <label  for="nombre">Nombre:</label>
            <input class="imput_form" type="hidden" id="id" name="id">
            <input class="imput_form" type="hidden" id="orden_n" name="orden_n">
            <input class="imput_form" type="text" id="nombre" name="nombre">
            <label for="work_time">Work Time:</label>
            <input  class="imput_form" type="number" id="work_time" name="work_time">
            <label for="short_break">Short Break:</label>
            <input class="imput_form" type="number" id="short_break" name="short_break">
            <label for="count">Count:</label>
            <input class="imput_form" type="number" id="count" name="count">
            <label for="type">Type:</label>
            <select class="imput_form" id="type" name="type">
                <option value="1">Pomodoro</option>
                <option value="2">Checker</option>
            </select>
            <button id="boton_agregar" onclick="guardar_habito_json()">Guardar</button>
        </div>
        </div>
      </div>
        
        

        
   
      
      
      
      </div>
      <div class="columna2">

        <div class="heatmap_principal">

          <div id="header"></div>
         
          <div class="center_div arriba_e">
              <div  id="cal-heatmap"></div>
          </div>
          <div class="center_div" >
            <button id="minDate-previous_year"><</button>
            <button id="minDate-next_year">></button>
        </div>
          <div>
              <div id="mes_habito"></div>
              <div class="center_div" >
                  
                  <button id="minDate-previous"><</button>
                  <button id="minDate-next">></button>
              </div>
              
          </div>
          <div id="onClick-placeholder"></div>
      </div>


      </div>
    </div>


  
    <script>

    
    </script> 




    <script>


  
  
      const { ipcRenderer } = require('electron');
      //const getDataBtn = document.getElementById('get-data');
        
          ipcRenderer.send('request-data');

          var data






          ipcRenderer.on('send-data', (event, data) => {



       

          

          });

          
          function llenar_lista_habitos(nombre_lista, hecho) {
            var data = fs.readFileSync("data.json", 'utf8');
            var jsonData = JSON.parse(data);
            //var sortedJsonData = [...jsonData].sort((a, b) => a.orden_n - b.orden_n);

            //data = sortedJsonData
            data = jsonData
            //console.log(data); // Aqu√≠ puedes usar los datos como quieras

            var lista = document.getElementById(nombre_lista);
            var records_h = leer_archivo_historial('historial_habitos.csv')
            //console.log(records_h)

            for (var i = 0; i < data.length; i++) {
              /*
              console.log(existeRegistroHoy(records_h, data[i].id))

              console.log(records_h)
              console.log(data[i].id)
              */

              if (existeRegistroHoy(records_h, data[i].id) == hecho) {




                var li = document.createElement("li");
                li.classList.add('elemento_lista')
                var div_item_h = document.createElement('div')
                var div_botones = document.createElement('div')
                li.appendChild(div_item_h)
                lista.appendChild(li);
                var Nombre_habito = document.createElement('h1')
                Nombre_habito.classList.add('titulo_habito')
                var texto_nombre = document.createTextNode(data[i].nombre)

                var boton_config = document.createElement("button")
                Nombre_habito.appendChild(texto_nombre)
                div_item_h.appendChild(boton_config);
                div_item_h.appendChild(Nombre_habito);
                var botn = document.createElement("button")
                var botn_graf = document.createElement("button")

                
                document.body.append(botn);
                div_item_h.appendChild(div_botones)
                //var texto = document.createTextNode("ir");
                //botn.appendChild(texto);

                //var texto_graf = document.createTextNode("&#xF1F6;");
                //botn_graf.appendChild(texto_graf);

                botn_graf.innerHTML = '<i class="material-icons">calendar_today</i>';
                document.body.append(botn_graf);


                // Asignar un valor al bot√≥n
                botn.value = data[i];
                botn_graf.value = data[i];
                div_botones.appendChild(botn)
                div_botones.appendChild(botn_graf)

                //console.log(data[i])

                let objeto = data[i]

                botn.classList.add('boton_habito')
                botn_graf.classList.add('boton_habito')
                
                boton_config.addEventListener('click', function () {
                  configurar_habito(objeto)
                  cambiarVentana('ventana2')
                })

                if (data[i].type == 1) {
                  div_item_h.classList.add('item_habito')
                  botn.innerHTML = '<i class="material-icons">alarm</i>';
                  botn.addEventListener('click', function () {
                    //console.log(data[i].id)
                    ipcRenderer.send('abrir-ventana-secundaria', objeto)
                  })
                } else {
                  div_item_h.classList.add('item_habito_check')
                  botn.innerHTML = '';
                  botn.innerHTML = '<i class="material-icons">check</i>';
                  botn.addEventListener('click', function () {
                    //console.log("check-" + objeto.id)
                    
                    
                    registrar_Habitos_checker(objeto.id)
                    actualizar_listas()
                    definir(objeto)
                    //ipcRenderer.send('abrir-ventana-secundaria', objeto)
                  })

                }

                botn_graf.addEventListener('click', function () {
                  //console.log(data[i].id)
                 // ipcRenderer.send('abrir-ventana-grafico', objeto)
                 definir(objeto)
                 //mostrar_flechas()

                })




              }
            }

            //eventos_lista_habitos()
            //ordenar_lista_habitos()
            //window.onload =  ordenar_lista_habitos
            window.onload = eventos_lista_habitos
        }

    
    actualizar_listas()
    </script>
    


    <!-- <h1>Hello World!aaeouaoeuao</h1>
    We are using Node.js <span id="node-version"></span>,
    Chromium <span id="chrome-version"></span>,
    and Electron <span id="electron-version"></span>.

    <ul id="miLista">
    </ul>

    <button id="get-data">Obtener datos</button> -->
    <!-- <script>
      //const { ipcRenderer } = require('electron');
      const getDataBtn = document.getElementById('get-data');

      getDataBtn.addEventListener('click', () => {
        ipcRenderer.send('request-data');
      });

      ipcRenderer.on('send-data', (event, data) => {
        console.log(data); // Aqu√≠ puedes usar los datos como quieras

        var lista = document.getElementById("miLista");

      for (var i = 0; i < data.length; i++) {
          var li = document.createElement("li");
          li.appendChild(document.createTextNode(data[i].name));
          lista.appendChild(li);
          var botn = document.createElement("button")
          var texto = document.createTextNode("ir");
          botn.appendChild(texto);

          // Asignar un valor al bot√≥n
          botn.value = data[i];
          //lista.appendChild(botn)

          console.log(data[i])

          let objeto = data[i]

          botn.addEventListener('click', function () {
            //console.log(data[i].id)
            ipcRenderer.send('abrir-ventana-secundaria', objeto)
          })
}
      });
    </script> -->


    <!-- <button id="abrirPomodoro">Abrir Pomodoro</button>

<script>
document.getElementById("abrirPomodoro").addEventListener("click", function() {
    window.open("pomodoro.html", "_blank", "width=200,height=200");
});
</script>

<button id="miBoton">
  aaaa
</button> -->



<!-- <script>
  
  document.getElementById("miBoton").addEventListener("click", function() {
      ipcRenderer.send('abrir-ventana-secundaria');
  });
  </script> -->



  <!-- <button id="cerrar">Cerrar ventana</button> -->

  <!-- <script>
    const { remote } = require('electron');
    
    document.getElementById("cerrar").addEventListener("click", function() {
        var ventana = remote.getCurrentWindow();
        ventana.close();
    });
    </script> -->




    <!-- <button id="btn1" value="1">1</button>
<button id="btn2" value="2">2</button>
<button id="btn3" value="3">3</button> -->

<!-- <script>
//const { ipcRenderer } = require('electron')

document.getElementById('btn1').addEventListener('click', function () {
  console.log('1')
  ipcRenderer.send('abrir-ventana-secundaria', this.value)
})

document.getElementById('btn2').addEventListener('click', function () {
  ipcRenderer.send('abrir-ventana-secundaria', this.value)
})

document.getElementById('btn3').addEventListener('click', function () {
  ipcRenderer.send('abrir-ventana-secundaria', this.value)
})
</script>
 -->

 <!-- <script src="node_modules/d3/dist/d3.min.js"></script>
 <script src="node_modules/papaparse/papaparse.min.js"></script>
  -->

<script>
// Primero, necesitas instalar heatmap.js en tu proyecto
// npm install heatmap.js

// Luego, en tu archivo JavaScript, puedes crear un heatmap as√≠:

/*

var h337 = require('heatmap.js');

// Aseg√∫rate de que el contenedor es un Element
var container = document.querySelector('.heatmap');

if (container instanceof Element) {
  var heatmapInstance = h337.create({
    container: container
  });

  var points = [];
  var max = 0;
  var len = 200;
  
  while (len--) {
    var val = Math.floor(Math.random()*100);
    max = Math.max(max, val);
    var point = {
      x: Math.floor(Math.random()*width),
      y: Math.floor(Math.random()*height),
      value: val
    };
    points.push(point);
  }
  
  var data = { 
    max: max, 
    data: points 
  };
  
  heatmapInstance.setData(data);
} else {
  console.error('El contenedor no es un Element');
}
*/

</script>



 





  

  







  </body>
</html>