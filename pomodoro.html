<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'">
    </head>
<body>

    <h1 id="header"></h1>

<script>
    var ciclos ;  // Define la cantidad de ciclos Pomodoro
    var tiempoTrabajo ;  // Tiempo de trabajo en segundos
    var tiempoDescanso ;  // Tiempo de descanso en segundos
    const { ipcRenderer } = require('electron')

    function definir() {
        return new Promise((resolve, reject) => {
    
            ipcRenderer.on('button-value', function (event, value) {
                ciclos = value.count;
                tiempoTrabajo = Number(value.work_time) * 60;
                tiempoDescanso = Number(value.short_break) * 60;

                document.getElementById('header').innerText = value.nombre;
    
                resolve([ciclos, tiempoTrabajo, tiempoDescanso]);
            });
        });
    }
    
    definir().then(([ciclos, tiempoTrabajo, tiempoDescanso]) => {
        console.log(ciclos);
        console.log(tiempoDescanso);
        console.log(tiempoTrabajo);
        pomodoro_()
        boton_cerrar()
        mover_ventana()
    }).catch(error => {
        console.error(error);
    });
    

//console.log('tiempo2', tiempo);  // Ahora puedes acceder a 'tiempo' desde fuera de la función


</script>







<h1 id="temporizador">25:00</h1>
<button id="iniciarPausar">Iniciar</button>

<button id="cerrar">Cerrar ventana</button>

<button id="titulo">
a
</button>




<script>
  
function pomodoro_(){



var corriendo = false;
var intervalo;
/*
var ciclos = 4;  // Define la cantidad de ciclos Pomodoro
var tiempoTrabajo = 25 * 60;  // Tiempo de trabajo en segundos
var tiempoDescanso = 5 * 60;  // Tiempo de descanso en segundos
*/
var tiempoRestante = tiempoTrabajo;  // Inicia el temporizador con el tiempo de trabajo
var enDescanso = false;

document.getElementById("iniciarPausar").addEventListener("click", function() {
    if (corriendo) {
        clearInterval(intervalo);
        this.textContent = "Iniciar";
    } else {
        intervalo = setInterval(function() {
            tiempoRestante--;
            var minutos = Math.floor(tiempoRestante / 60);
            var segundos = tiempoRestante % 60;
            document.getElementById("temporizador").textContent = minutos + ":" + (segundos < 10 ? "0" : "") + segundos;
            if (tiempoRestante <= 0) {
                clearInterval(intervalo);
                if (enDescanso) {
                    // Si estaba en descanso, vuelve al tiempo de trabajo
                    tiempoRestante = tiempoTrabajo;
                    console.log(tiempoRestante)
                    enDescanso = false;
                } else {
                    // Si estaba trabajando, pasa al tiempo de descanso
                    tiempoRestante = tiempoDescanso;
                    console.log(tiempoRestante)
                    enDescanso = true;
                    ciclos--;
                }
                if (ciclos > 0) {
                    // Si aún quedan ciclos, reinicia el intervalo
                    intervalo = setInterval(arguments.callee, 1000);
                    console.log(ciclos)
                }
            }
        }, 1000);
        this.textContent = "Pausar";
    }
    corriendo = !corriendo;
});



}

/*
  console.log('tiempo')
    console.log(tiempo)
//var tiempoRestante = 1500; // 25 minutos en segundos

console.log(tiempoRestante)
var corriendo = false;
var intervalo;
document.getElementById("iniciarPausar").addEventListener("click", function() {
    if (corriendo) {
        clearInterval(intervalo);
        this.textContent = "Iniciar";
    } else {
        intervalo = setInterval(function() {
            tiempoRestante--;
            var minutos = Math.floor(tiempoRestante / 60);
            var segundos = tiempoRestante % 60;
            document.getElementById("temporizador").textContent = minutos + ":" + (segundos < 10 ? "0" : "") + segundos;
            if (tiempoRestante <= 0) {
                clearInterval(intervalo);
            }
        }, 1000);
        this.textContent = "Pausar";
    }
    corriendo = !corriendo;
});

*/
</script>

<script>
    //const { ipcRenderer } = require('electron');


    function boton_cerrar(){

        
        document.getElementById("cerrar").addEventListener("click", function() {
            ipcRenderer.send('cerrar-ventana-pom');
        });
    }
    </script>
    



    <!-- <script>
       
        
        var moviendo = false;
        var offsetX, offsetY;
        
        var ventana = remote.getCurrentWindow();
        var titulo = document.getElementById("titulo");
        
        titulo.addEventListener("mousedown", function(e) {
            moviendo = true;
            offsetX = e.clientX;
            offsetY = e.clientY;
        });
        
        titulo.addEventListener("mouseup", function() {
            moviendo = false;
        });
        
        titulo.addEventListener("mousemove", function(e) {
            if (moviendo) {
                ventana.setPosition(e.screenX - offsetX, e.screenY - offsetY);
            }
        });
        </script> -->


        <!-- <script>
           // const { ipcRenderer } = require('electron');

var moviendo = false;
var offsetX, offsetY;

var titulo = document.getElementById("titulo");

titulo.addEventListener("mousedown", function(e) {
    moviendo = true;
    offsetX = e.clientX;
    offsetY = e.clientY;
});

titulo.addEventListener("mouseup", function() {
    moviendo = false;
});

titulo.addEventListener("mousemove", function(e) {
    if (moviendo) {
        ipcRenderer.send('mover-ventana-pom', {x: e.screenX - offsetX, y: e.screenY - offsetY});
    }
});
        </script> -->


        <script>
            // En el proceso de renderizado
//const { ipcRenderer } = require('electron');


function mover_ventana(){

    
    var moviendo = false;
    var offsetX, offsetY;
    
    var titulo = document.getElementById("titulo");
    
    titulo.addEventListener("pointerdown", function(e) {
    moviendo = true;
    offsetX = e.clientX;
    offsetY = e.clientY;
    //var ventana = ipcRenderer.sendSync('obtener-ventana');
    //moviendo = true;
    //offsetX = e.clientX - ventana.x;
    //offsetY = e.clientY - ventana.y;
    //offsetX = e.clientX - ventana.bounds.x;
    //offsetY = e.clientY - ventana.bounds.y;
});

document.addEventListener("pointerup", function() {
    moviendo = false;
});

document.addEventListener("pointermove", function(e) {
    if (moviendo) {
        ipcRenderer.send('mover-ventana-pom', {x: e.screenX - offsetX, y: e.screenY - offsetY});
    }
});

}
</script>

</body>
</html>
